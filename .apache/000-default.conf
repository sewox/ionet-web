<VirtualHost *:80>
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/html

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

# ========================================================================
# CRITICAL FIX: ProxyPassMatch MUST be used to prevent Alias conflict
# ========================================================================
# ProxyPass yerine ProxyPassMatch kullan - daha yüksek öncelik
# Backend 3001 portunda çalışıyor olmalı

ProxyPreserveHost On

# I/ONET Web API Proxy - ProxyPassMatch kullan (Alias'ı bypass eder)
ProxyPassMatch ^//api/(.*)$ http://localhost:3001//api/$1
ProxyPassReverse //api http://localhost:3001//api

# I/ONET Web Uploads Proxy
ProxyPassMatch ^//uploads/(.*)$ http://localhost:3001//uploads/$1
ProxyPassReverse //uploads http://localhost:3001//uploads

# ========================================================================
# React Applications
# ========================================================================

# React Uygulaması: destekportali
# Url Path: /destekportali

Alias /destekportali "/var/www/destekportali/frontend/dist"

<Directory "/var/www/destekportali/frontend/dist">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted

    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase /destekportali/

        # index.html ise işlem yapma
        RewriteRule ^index\.html$ - [L]

        # Dosya veya klasör varsa direkt eriş
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d

        # Yoksa index.html'e yönlendir (SPA Routing)
        RewriteRule . index.html [L]
    </IfModule>
</Directory>


# React Uygulaması: ionet-web
# Url Path: /

Alias / "/var/www//dist"

<Directory "/var/www//dist">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted

    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase //

        # index.html ise işlem yapma
        RewriteRule ^index\.html$ - [L]

        # Dosya veya klasör varsa direkt eriş
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d

        # CRITICAL: API ve uploads isteklerini EXCLUDE et (yukarıda proxy ediliyor)
        RewriteCond %{REQUEST_URI} !^//api/
        RewriteCond %{REQUEST_URI} !^//uploads/

        # Yoksa index.html'e yönlendir (SPA Routing)
        RewriteRule . index.html [L]
    </IfModule>
</Directory>

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
